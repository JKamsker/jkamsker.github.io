<article class="post-article">
  <header class="post-header">
    <div class="post-header__categories">
      {% if post %} {% assign categories = post.categories %} {% else %} {%
      assign categories = page.categories %} {% endif %}
      {% for category in categories %}
      <a href="{{ '/blog/categories/' | append: category | slugize | relative_url }}" class="post-category-pill">{{ category }}</a>
      {% unless forloop.last %} {% endunless %}
      {% endfor %}
    </div>
    <h1 class="post-header__title">{{ page.title }}</h1>
    <p class="post-header__summary">{{ page.summary }}</p>
    <div class="post-header__byline">
      {% if page.author %}
      {% assign author_data = site.data.authors[page.author] %}
      <a href="{{ '/blog/authors/' | append: page.author | append: '/' | relative_url }}" class="post-header__author">{{ author_data.name | default: page.author }}</a>
      <span class="post-header__dot">&middot;</span>
      {% endif %}
      <time datetime="{{ page.date | date_to_xmlschema }}" class="post-header__date">{{ page.date | date: "%b %-d, %Y" }}</time>
      <span class="post-header__dot">&middot;</span>
      <span class="post-header__reading-time">{% assign words = content | number_of_words %}{{ words | divided_by: 200 | plus: 1 }} min read</span>
    </div>
  </header>

  {% if page.thumbnail %}
  <div class="post-thumbnail">
    <img src="{{ page.thumbnail | relative_url }}" alt="{{ page.title }}" width="1200" height="630" />
  </div>
  {% endif %}

  <div class="post-content">
    {{ content }}
  </div>

  {% if page.tags %}
  <div class="post-tags">
    {% for tag in page.tags %}
    <span class="post-tag">#{{ tag }}</span>
    {% endfor %}
  </div>
  {% endif %}

  <div class="post-divider"></div>

  {%- include share_page.html -%}

  {% assign author = site.data.authors[page.author] %}
  {% if author %}
    {% include author.html %}
  {% endif %}

  {% if site.giscus_repo and site.giscus_repo_id and site.giscus_category and site.giscus_category_id and site.giscus_category_id != "" %}
  <div class="post-comments">
    <script src="https://giscus.app/client.js"
        data-repo="{{ site.giscus_repo }}"
        data-repo-id="{{ site.giscus_repo_id }}"
        data-category="{{ site.giscus_category }}"
        data-category-id="{{ site.giscus_category_id }}"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
    </script>
  </div>
  {% endif %}
</article>

<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.post-content div.highlighter-rouge').forEach(function (block) {
    var btn = document.createElement('button');
    btn.className = 'code-copy-btn';
    btn.setAttribute('aria-label', 'Copy code');
    btn.innerHTML = '<i class="fa fa-clipboard"></i>';
    btn.addEventListener('click', function () {
      var code = block.querySelector('code');
      if (!code) return;
      navigator.clipboard.writeText(code.textContent).then(function () {
        btn.innerHTML = '<i class="fa fa-check"></i>';
        btn.classList.add('copied');
        setTimeout(function () {
          btn.innerHTML = '<i class="fa fa-clipboard"></i>';
          btn.classList.remove('copied');
        }, 2000);
      });
    });
    block.style.position = 'relative';
    block.appendChild(btn);
  });
});
</script>
